
let .with-phi(tctx: TypeContext?, tt: Type): Type = (
   if tt.is-t(c"Phi::Id",1) && not(tt.is-t(c"Phi::State",1)) {
      let phi-state = tctx.lookup-phi(tt.slot(c"Phi::Id",1).l1.simple-tag).phi-tt;
      tt = tt && t1(c"Phi::State", phi-state);
   };
   tt
);

