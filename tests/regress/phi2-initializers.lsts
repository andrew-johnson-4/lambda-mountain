
import lib/std/default.lsts;

type phi ABCDEF = A | B | C | D | E | F;

let f(): U64+Phi::Initialize<A> = 123;
let g(x: U64+Phi::Transition<A,B>): U64 = 123;
let h(x: U64+Phi::Transition<B,C>): U64 = 123;
let i(x: U64+Phi::Transition<B,D>): U64 = 123;
let j(x: U64+Phi::Transition<E,F>): U64 = 123;
let phi(l: C, r: D): E;

let no-phi(phi-x: x): Nil = (
   assert(not( typeof(phi-x) <: type(Phi::State<Any>) ));
);

let only-phi-state(phi-x: U64+Phi::State<B>): Nil = (
   print("only-phi-state \{typeof(phi-x)}\n");
   assert( typeof(phi-x) <: type(Phi::State<B>) );
);

let only-phi-transition(phi-x: U64+Phi::Transition<B,B>): Nil = (
   print("only-phi-transition \{typeof(phi-x)}\n");
   assert( typeof(phi-x) <: type(Phi::State<B>) );
);

let x = f();
assert( typeof(x) <: type(U64+Phi::State<A>) );

g(x);
only-phi-state(x);
only-phi-transition(x);
assert( typeof(x) <: type(U64+Phi::State<B>) );

if true {
   h(x);
} else {
   i(x);
};
if true then j(x) else j(x);
assert( typeof(x) <: type(U64+Phi::State<F>) );

no-phi(x);
