
import lib2/core/bedrock.lsts;

type T = { tag:CString };

let .ground-tag-and-arity(tt: T): (CString,U64) = (
   let t1 = open(tt);
   (scope($"if"
      (
         let c1 = false;
         $"if"
            (
               let t2 = open((t1 as Tag::T).tag);
               t2 == c"Array"
            )
            (c1 = true)
            ()
         ;
         c1
      )
      ((c"Array", 2_u64))
      (scope($"if"
         (
            let t3 = t1;
            let c2 = false;
            $"if"
               (t3.discriminator-case-tag == (t3 as Tag::T).discriminator-case-tag)
               ($"if"
                 (let tag = open((t3 as Tag::T).tag); branchtrue())
                 (c2 = true)
                 ()
               )
               ()
            ;
            c2
         )
         ((tag, 1_u64))
         (fail(c"Pattern Match Failure"))
      ))
   ))
);


