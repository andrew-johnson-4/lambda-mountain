
import lib/std/minimal.lsts;

([] : List<U8>) + ([] : List<U8>);
assert( safe-alloc-block-count == 0 );
# no allocations, only stack
assert( safe-alloc-block-count-monotonic == 0 );
safe-alloc-block-count-monotonic = 0;

cons(2,cons(1, [] : List<U8>)) + ([] : List<U8>);
assert( safe-alloc-block-count == 0 );
# no new allocations other than arguments
assert( safe-alloc-block-count-monotonic == 2 );
safe-alloc-block-count-monotonic = 0;

cons(2,cons(1, [] : List<U8>)) + cons(3, [] : List<U8>);
assert( safe-alloc-block-count == 0 );
# 2 + 1 allocations for arguments
# 2 allocations for new list cells to move left argument
# 1 allocation for temporary vector
assert( safe-alloc-block-count-monotonic == 6 );
safe-alloc-block-count-monotonic = 0;

cons(2,cons(1, [] : List<U8>)) + cons(4,cons(3, [] : List<U8>));
assert( safe-alloc-block-count == 0 );
# 2 + 2 allocations for arguments
# 2 allocations for new list cells to move left argument
# 1 allocation for temporary vector
assert( safe-alloc-block-count-monotonic == 7 );
safe-alloc-block-count-monotonic = 0;

([] : List<U8>) + cons(2,cons(1, [] : List<U8>));
assert( safe-alloc-block-count == 0 );
# no new allocations other than arguments
assert( safe-alloc-block-count-monotonic == 2 );
safe-alloc-block-count-monotonic = 0;

cons(3, [] : List<U8>) + cons(2,cons(1, [] : List<U8>));
assert( safe-alloc-block-count == 0 );
# 1 + 2 allocations for arguments
# 1 allocations for new list cells to move left argument
# temporary vector is not necessary
assert( safe-alloc-block-count-monotonic == 4 );
safe-alloc-block-count-monotonic = 0;

cons(4,cons(3, [] : List<U8>)) + cons(2,cons(1, [] : List<U8>));
assert( safe-alloc-block-count == 0 );
# 2 + 2 allocations for arguments
# 2 allocations for new list cells to move left argument
# 1 allocation for temporary vector
assert( safe-alloc-block-count-monotonic == 7 );
safe-alloc-block-count-monotonic = 0;

