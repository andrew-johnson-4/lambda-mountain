
import LM23COMMON/unit-ast-core.lsts;

type TypeContextRow zero NullTypeContextRow = NullTypeContextRow | TypeContextRow { key: CString, nt: Type, dt: Type, blame: AST };
type PhiContextRow zero NullPhiContextRow = NullPhiContextRow | PhiContextRow { phi-id: CString, phi-tt: Type, blame: AST, dead-on-arrival: Bool, is-global: Bool };
type TypeContext = { tctx:List<TypeContextRow>, pctx: List<PhiContextRow>, is-unsafe: Bool, is-blob: Bool, function-name:CString };

let .phi-append(tctx-primary: TypeContext?, tctx-secondary: TypeContext?): TypeContext? = tctx-primary;

let std-apply-macro-candidates(tctx: TypeContext?, mname: CString, margs: AST, candidates: List<(Type,AST)>): (TypeContext?, AST) = (
   let t = mk-eof();
   let mctx = (None : AContext?)();
   mctx = union(mctx, Some(extract-uuids(t)));
   t = substitute(mctx.get-or-panic, t).with-location-preserve(margs.location);
   (tctx, t)
);

let std-try-destructure-macro(tctx: TypeContext?, margs: AST, mtype: Type, mcandidate: AST): (TypeContext?, AContext?) = (
   let mctx = (None : AContext?)();
   (tctx, mctx)
);

let extract-uuids(term: AST): AContext = (
   let mctx = [] : AContext;
   mctx;
);
